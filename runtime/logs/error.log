2018-06-15 14:01:05：array (
)

2018-06-15 14:01:37：array (
  0 => 
  array (
    'queueId' => 16,
    'blogId' => 12,
    'action' => 1,
    'publishStatus' => 0,
    'response' => '',
    'createtime' => '2018-06-15',
    'updatetime' => '2018-06-15',
    'blogType' => 6,
  ),
)

2018-06-15 14:01:37：<?xml version="1.0" encoding="utf-8"?>
<methodCall>
<methodName>metaWeblog.newPost</methodName>
<params>
    <param>
        <value>
        <string>1</string>
        </value>
    </param>
    <param>
        <value>
        <string>jueze</string>
        </value>
    </param>
    <param>
        <value>
        <string>yi877900230!</string>
        </value>
    </param>
    <param>
       <value>
        <struct>
            <member>
              <name>title</name>
              <value>
                <string>微信公众号-模板消息通用接口封装</string>
              </value>
            </member>
            <member>
              <name>description</name>
              <value>
                <string>### 微信公众号-模板消息通用接口封装
近期做了微信公众号的消息通知，微信方面模板越来越规范化，跟测试的平台相差甚远（fuck，谁让人家要办硬）。

话不多说，进入代码
```php
class OfficialSystem
{
    public $tmplateConf;
    private $accessToken;       //微信accessToken

    public function __construct( $tmplateConf ,$accessToken ){
        $this-&gt;tmplateConf = $tmplateConf;
        $this-&gt;accessToken = $accessToken;
    }

    /**
    * 返回结果
    * @param $error bool 1 代表错误，0 无错误
    * @parame $msg string   返回信息
    * @param $data Array    返回内容
    * @param $isJson bool  1 返回json， 0 否
    **/
    public function returnResult( $error,$msg ,$data=[],$isJson=0 ){
        $result = [
            &apos;error&apos; =&gt; $error,
            &apos;msg&apos; =&gt; $msg,
            &apos;data&apos; =&gt; $data,
        ];
        if( $isJson ){
            echo json_encode($result);
            exit();
        }
        return $result;
    }

    /**
    * 发送消息
    * @param $modelId sting  微信模板id
    * @param $touser string  微信openid（公众号）
    * @param $url string    跳转地址
    * @param $miniPagepath string 小程序跳转路径
    * @param $miniAppid  string   小程序Appid
    * @param $list  Array   模板数据，如：[ [&apos;value&apos;=&gt;&apos;您好，您有新的订单&apos;,&apos;color&apos;=&gt;&apos;blue&apos;,...] ]
    **/
    public function Sendmsg( $modelId,$touser,$url,$miniPagepath,$miniAppid,$list=[] ){
        if( empty($modelId) || empty($touser) || empty($list)  ) $this-&gt;returnResult(1,&apos;参数缺失&apos;);

        $template_id =  !empty( $this-&gt;tmplateConf[$modelId] ) ? $this-&gt;tmplateConf[$modelId]:$this-&gt;returnResult(1,&apos;模板错误&apos;);

        //模板消息内容  数组第一个作为标题，最后一个作为备注
        $data = [];
        foreach ($list as $k=&gt;$v){
            $key = $k==0 ? &apos;first&apos;:&quot;keyword&quot;.$k;

            if( !isset( $list[$k+1] ) ) $key = &apos;remark&apos;;

            $data[$key] = [
                &apos;value&apos; =&gt;  $v[&apos;value&apos;],
                &apos;color&apos; =&gt;  !empty($v[&apos;color&apos;])? $v[&apos;color&apos;]:&apos;#173177&apos;,
            ];
        }

        $sends = $this-&gt;sendModelMsg($touser,$template_id,$url,$miniAppid,$miniPagepath,$data);

        $this-&gt;returnResult(0,&apos;success&apos;,$sends);
    }

    /**
     * @param $touser   用户openid
     * @param $template_id
     * @param $url
     * @param $miniAppid
     * @param $miniPagepath     小程序跳转地址
     * @param $data     模板数据
     */
    public function sendModelMsg( $touser,$template_id,$url=&apos;&apos;,$miniAppid=&apos;&apos;,$miniPagepath=&apos;&apos;,$data ){

        $interfaceUrl = &apos;https://api.weixin.qq.com/cgi-bin/message/template/send?access_token=&apos;.$this-&gt;accessToken;

        $params = [
            &apos;touser&apos;            =&gt;          $touser,
            &apos;template_id&apos;       =&gt;          $template_id,
            &apos;url&apos;               =&gt;          $url,
            &apos;miniprogram&apos;       =&gt;          [ &apos;appid&apos;=&gt;$miniAppid,&apos;path&apos;=&gt;$miniPagepath ]   ,
            &apos;data&apos;              =&gt;          $data,
        ];

        $sends = $this-&gt;httpPost($interfaceUrl,json_encode($params));
        $sends = json_decode($sends,1);

        if( $sends&amp;&amp;$sends[&apos;errmsg&apos;]!=&apos;ok&apos; ){
             $this-&gt;returnResult(1,&apos;消息发送失败&apos;,$sends);
        }

        return $sends;
    }

    /**
     * 获取用户信息
     * @param $openid  openid
     * @return mixed
     */
    public function getUserInfo( $openid=&apos;&apos; ){

        $interfaceUrl = &apos;https://api.weixin.qq.com/cgi-bin/user/info?access_token=&apos;.$this-&gt;accessToken.&apos;&amp;openid=&apos;.$openid;
        $info = $this-&gt;httpGet( $interfaceUrl );
        $result = json_decode($info,1);

        return $result;
    }

    /**
     * @param $touser
     * @param $msgtype
     * @param $msgContent
     */
    public function sendCustomMsg( $touser,$msgtype,$msgContent){
//        $params = [];
//        $params[&apos;touser&apos;] = $touser;
//        $params[&apos;msgtype&apos;] = $msgtype;
//        $params[&quot;$msgtype&quot;] = $msgContent;
//        $params = json_encode($params);
        $params = &apos;{&quot;touser&quot;:&quot;&apos;.$touser.&apos;&quot;,&quot;msgtype&quot;:&quot;&apos;.$msgtype.&apos;&quot;,&quot;text&quot;:{&apos;.$msgContent.&apos;}}&apos;;

        $interfaceUrl = &apos;https://api.weixin.qq.com/cgi-bin/message/custom/send?access_token=&apos;.$this-&gt;accessToken;
        $sends = $this-&gt;httpPost($interfaceUrl,$params);//var_dump($params,json_encode($params),$sends);die;
        $sends = json_decode($sends,1);
        return $sends;
    }

    private function httpGet($url) {
        $curl = curl_init();

        curl_setopt_array($curl, array(
            CURLOPT_URL =&gt; $url,
            CURLOPT_RETURNTRANSFER =&gt; true,
            CURLOPT_ENCODING =&gt; &quot;&quot;,
            CURLOPT_MAXREDIRS =&gt; 10,
            CURLOPT_TIMEOUT =&gt; 30,
            CURLOPT_HTTP_VERSION =&gt; CURL_HTTP_VERSION_1_1,
            CURLOPT_CUSTOMREQUEST =&gt; &quot;GET&quot;,
            CURLOPT_HTTPHEADER =&gt; array(
                &quot;cache-control: no-cache&quot;,
                &quot;content-type: application/x-www-form-urlencoded&quot;,
            ),
        ));

        $response = curl_exec($curl);
        $err = curl_error($curl);

        curl_close($curl);

        if ($err) {
            echo &quot;cURL Error #:&quot; . $err;die;
        } else {
            return $response;
        }
    }

    private function httpPost($url,$param){
        $curl = curl_init();

        curl_setopt_array($curl, array(
            CURLOPT_URL =&gt; $url,
            CURLOPT_RETURNTRANSFER =&gt; true,
            CURLOPT_ENCODING =&gt; &quot;&quot;,
            CURLOPT_MAXREDIRS =&gt; 10,
            CURLOPT_TIMEOUT =&gt; 30,
            CURLOPT_HTTP_VERSION =&gt; CURL_HTTP_VERSION_1_1,
            CURLOPT_CUSTOMREQUEST =&gt; &quot;POST&quot;,
            CURLOPT_POSTFIELDS =&gt; $param,
            CURLOPT_HTTPHEADER =&gt; array(
                &quot;cache-control: no-cache&quot;,
                &quot;content-type: application/json&quot;,
                &apos;Content-Length:&apos; . strlen($param)
            ),
        ));

        $response = curl_exec($curl);
        $err = curl_error($curl);

        curl_close($curl);

        if ($err) {
            return &quot;cURL Error #:&quot; . $err;
        } else {
            return $response;
        }

}
```


调用事例：
```php
$tmplateConf = [
     &apos;1&apos;      =&gt;  &apos;mnscOp2RHpQtDCt7OpZBLoDTU2fjJ_W75_Mat4rnfxM&apos;,         //订货通知模板
     &apos;2&apos;      =&gt;  &apos;DL4EAD47KT1tggbL2OR8iRAYLORI64V4YEM8mjQfSWU&apos;,         //入库通知模板
];
$accessToken = &apos;o9BuWjkDBvLGV_nch9wPU_-KRp7M&apos;;
$OfficialSystem = new OfficialSystem($tmplateConf,$accessToken);

//消息内容
$list = [
        [&apos;value&apos;=&gt;&apos;您好，您有新的订单&apos;,&apos;color&apos;=&gt;&apos;blue&apos;],
        [&apos;value&apos;=&gt;&apos;P201809010001&apos;,&apos;color&apos;=&gt;&apos;&apos;],
        [&apos;value&apos;=&gt;&apos;服务中心店&apos;,&apos;color&apos;=&gt;&apos;&apos;],
        [&apos;value&apos;=&gt;&apos;2018-06-01 10:30:30&apos;,&apos;color&apos;=&gt;&apos;&apos;],
        [&apos;value&apos;=&gt;&apos;点击进入详情&apos;,&apos;color&apos;=&gt;&apos;&apos;],
    ];
$modelId = 1;
$touser = &apos;o9BuWjkDBvLGV_nch9wPU_-KRp7M&apos;;
$url = &apos;http://www.cnblogs.com/followyou&apos;;
$sends = Sendmsg( $modelId,$touser,$url,$miniPagepath=&apos;&apos;,$miniAppid=&apos;&apos;,$list);
var_dump($sends);
```

成功返回：
```
        &quot;errcode&quot;: &quot;0&quot;,
        &quot;errmsg&quot;: &quot;ok&quot;,
        &quot;msgid&quot;: &quot;325381129559375872&quot;
```
 仅供参考，代码也就这样哈！</string>
              </value>
            </member>
            <member>
                <name>categories</name>
                <value>
                  <array>
                    <data>
                        <value>
                            <string>[Markdown]</string>
                        </value>
                     </data>
                   </array>
                  </value>
            </member>
        </struct>
       </value>
    </param>
    <param>
       <value>
        <boolean>1</boolean>
       </value>
    </param>
</params></methodCall>

2018-06-15 14:01:42：response is empty

2018-06-15 14:05:46：array (
)

2018-06-15 14:08:00：array (
  0 => 
  array (
    'queueId' => 16,
    'blogId' => 12,
    'action' => 1,
    'publishStatus' => 0,
    'response' => '',
    'createtime' => '2018-06-15',
    'updatetime' => '2018-06-15',
    'blogType' => 6,
  ),
)

2018-06-15 14:08:00：<?xml version="1.0" encoding="utf-8"?>
<methodCall>
<methodName>metaWeblog.newPost</methodName>
<params>
    <param>
        <value>
        <string>1</string>
        </value>
    </param>
    <param>
        <value>
        <string>jueze</string>
        </value>
    </param>
    <param>
        <value>
        <string>yi877900230!</string>
        </value>
    </param>
    <param>
       <value>
        <struct>
            <member>
              <name>title</name>
              <value>
                <string>微信公众号-模板消息通用接口封装</string>
              </value>
            </member>
            <member>
              <name>description</name>
              <value>
                <string>### 微信公众号-模板消息通用接口封装
近期做了微信公众号的消息通知，微信方面模板越来越规范化，跟测试的平台相差甚远（fuck，谁让人家要办硬）。

话不多说，进入代码
```php
class OfficialSystem
{
    public $tmplateConf;
    private $accessToken;       //微信accessToken

    public function __construct( $tmplateConf ,$accessToken ){
        $this-&gt;tmplateConf = $tmplateConf;
        $this-&gt;accessToken = $accessToken;
    }

    /**
    * 返回结果
    * @param $error bool 1 代表错误，0 无错误
    * @parame $msg string   返回信息
    * @param $data Array    返回内容
    * @param $isJson bool  1 返回json， 0 否
    **/
    public function returnResult( $error,$msg ,$data=[],$isJson=0 ){
        $result = [
            &apos;error&apos; =&gt; $error,
            &apos;msg&apos; =&gt; $msg,
            &apos;data&apos; =&gt; $data,
        ];
        if( $isJson ){
            echo json_encode($result);
            exit();
        }
        return $result;
    }

    /**
    * 发送消息
    * @param $modelId sting  微信模板id
    * @param $touser string  微信openid（公众号）
    * @param $url string    跳转地址
    * @param $miniPagepath string 小程序跳转路径
    * @param $miniAppid  string   小程序Appid
    * @param $list  Array   模板数据，如：[ [&apos;value&apos;=&gt;&apos;您好，您有新的订单&apos;,&apos;color&apos;=&gt;&apos;blue&apos;,...] ]
    **/
    public function Sendmsg( $modelId,$touser,$url,$miniPagepath,$miniAppid,$list=[] ){
        if( empty($modelId) || empty($touser) || empty($list)  ) $this-&gt;returnResult(1,&apos;参数缺失&apos;);

        $template_id =  !empty( $this-&gt;tmplateConf[$modelId] ) ? $this-&gt;tmplateConf[$modelId]:$this-&gt;returnResult(1,&apos;模板错误&apos;);

        //模板消息内容  数组第一个作为标题，最后一个作为备注
        $data = [];
        foreach ($list as $k=&gt;$v){
            $key = $k==0 ? &apos;first&apos;:&quot;keyword&quot;.$k;

            if( !isset( $list[$k+1] ) ) $key = &apos;remark&apos;;

            $data[$key] = [
                &apos;value&apos; =&gt;  $v[&apos;value&apos;],
                &apos;color&apos; =&gt;  !empty($v[&apos;color&apos;])? $v[&apos;color&apos;]:&apos;#173177&apos;,
            ];
        }

        $sends = $this-&gt;sendModelMsg($touser,$template_id,$url,$miniAppid,$miniPagepath,$data);

        $this-&gt;returnResult(0,&apos;success&apos;,$sends);
    }

    /**
     * @param $touser   用户openid
     * @param $template_id
     * @param $url
     * @param $miniAppid
     * @param $miniPagepath     小程序跳转地址
     * @param $data     模板数据
     */
    public function sendModelMsg( $touser,$template_id,$url=&apos;&apos;,$miniAppid=&apos;&apos;,$miniPagepath=&apos;&apos;,$data ){

        $interfaceUrl = &apos;https://api.weixin.qq.com/cgi-bin/message/template/send?access_token=&apos;.$this-&gt;accessToken;

        $params = [
            &apos;touser&apos;            =&gt;          $touser,
            &apos;template_id&apos;       =&gt;          $template_id,
            &apos;url&apos;               =&gt;          $url,
            &apos;miniprogram&apos;       =&gt;          [ &apos;appid&apos;=&gt;$miniAppid,&apos;path&apos;=&gt;$miniPagepath ]   ,
            &apos;data&apos;              =&gt;          $data,
        ];

        $sends = $this-&gt;httpPost($interfaceUrl,json_encode($params));
        $sends = json_decode($sends,1);

        if( $sends&amp;&amp;$sends[&apos;errmsg&apos;]!=&apos;ok&apos; ){
             $this-&gt;returnResult(1,&apos;消息发送失败&apos;,$sends);
        }

        return $sends;
    }

    /**
     * 获取用户信息
     * @param $openid  openid
     * @return mixed
     */
    public function getUserInfo( $openid=&apos;&apos; ){

        $interfaceUrl = &apos;https://api.weixin.qq.com/cgi-bin/user/info?access_token=&apos;.$this-&gt;accessToken.&apos;&amp;openid=&apos;.$openid;
        $info = $this-&gt;httpGet( $interfaceUrl );
        $result = json_decode($info,1);

        return $result;
    }

    /**
     * @param $touser
     * @param $msgtype
     * @param $msgContent
     */
    public function sendCustomMsg( $touser,$msgtype,$msgContent){
//        $params = [];
//        $params[&apos;touser&apos;] = $touser;
//        $params[&apos;msgtype&apos;] = $msgtype;
//        $params[&quot;$msgtype&quot;] = $msgContent;
//        $params = json_encode($params);
        $params = &apos;{&quot;touser&quot;:&quot;&apos;.$touser.&apos;&quot;,&quot;msgtype&quot;:&quot;&apos;.$msgtype.&apos;&quot;,&quot;text&quot;:{&apos;.$msgContent.&apos;}}&apos;;

        $interfaceUrl = &apos;https://api.weixin.qq.com/cgi-bin/message/custom/send?access_token=&apos;.$this-&gt;accessToken;
        $sends = $this-&gt;httpPost($interfaceUrl,$params);//var_dump($params,json_encode($params),$sends);die;
        $sends = json_decode($sends,1);
        return $sends;
    }

    private function httpGet($url) {
        $curl = curl_init();

        curl_setopt_array($curl, array(
            CURLOPT_URL =&gt; $url,
            CURLOPT_RETURNTRANSFER =&gt; true,
            CURLOPT_ENCODING =&gt; &quot;&quot;,
            CURLOPT_MAXREDIRS =&gt; 10,
            CURLOPT_TIMEOUT =&gt; 30,
            CURLOPT_HTTP_VERSION =&gt; CURL_HTTP_VERSION_1_1,
            CURLOPT_CUSTOMREQUEST =&gt; &quot;GET&quot;,
            CURLOPT_HTTPHEADER =&gt; array(
                &quot;cache-control: no-cache&quot;,
                &quot;content-type: application/x-www-form-urlencoded&quot;,
            ),
        ));

        $response = curl_exec($curl);
        $err = curl_error($curl);

        curl_close($curl);

        if ($err) {
            echo &quot;cURL Error #:&quot; . $err;die;
        } else {
            return $response;
        }
    }

    private function httpPost($url,$param){
        $curl = curl_init();

        curl_setopt_array($curl, array(
            CURLOPT_URL =&gt; $url,
            CURLOPT_RETURNTRANSFER =&gt; true,
            CURLOPT_ENCODING =&gt; &quot;&quot;,
            CURLOPT_MAXREDIRS =&gt; 10,
            CURLOPT_TIMEOUT =&gt; 30,
            CURLOPT_HTTP_VERSION =&gt; CURL_HTTP_VERSION_1_1,
            CURLOPT_CUSTOMREQUEST =&gt; &quot;POST&quot;,
            CURLOPT_POSTFIELDS =&gt; $param,
            CURLOPT_HTTPHEADER =&gt; array(
                &quot;cache-control: no-cache&quot;,
                &quot;content-type: application/json&quot;,
                &apos;Content-Length:&apos; . strlen($param)
            ),
        ));

        $response = curl_exec($curl);
        $err = curl_error($curl);

        curl_close($curl);

        if ($err) {
            return &quot;cURL Error #:&quot; . $err;
        } else {
            return $response;
        }

}
```


调用事例：
```php
$tmplateConf = [
     &apos;1&apos;      =&gt;  &apos;mnscOp2RHpQtDCt7OpZBLoDTU2fjJ_W75_Mat4rnfxM&apos;,         //订货通知模板
     &apos;2&apos;      =&gt;  &apos;DL4EAD47KT1tggbL2OR8iRAYLORI64V4YEM8mjQfSWU&apos;,         //入库通知模板
];
$accessToken = &apos;o9BuWjkDBvLGV_nch9wPU_-KRp7M&apos;;
$OfficialSystem = new OfficialSystem($tmplateConf,$accessToken);

//消息内容
$list = [
        [&apos;value&apos;=&gt;&apos;您好，您有新的订单&apos;,&apos;color&apos;=&gt;&apos;blue&apos;],
        [&apos;value&apos;=&gt;&apos;P201809010001&apos;,&apos;color&apos;=&gt;&apos;&apos;],
        [&apos;value&apos;=&gt;&apos;服务中心店&apos;,&apos;color&apos;=&gt;&apos;&apos;],
        [&apos;value&apos;=&gt;&apos;2018-06-01 10:30:30&apos;,&apos;color&apos;=&gt;&apos;&apos;],
        [&apos;value&apos;=&gt;&apos;点击进入详情&apos;,&apos;color&apos;=&gt;&apos;&apos;],
    ];
$modelId = 1;
$touser = &apos;o9BuWjkDBvLGV_nch9wPU_-KRp7M&apos;;
$url = &apos;http://www.cnblogs.com/followyou&apos;;
$sends = Sendmsg( $modelId,$touser,$url,$miniPagepath=&apos;&apos;,$miniAppid=&apos;&apos;,$list);
var_dump($sends);
```

成功返回：
```
        &quot;errcode&quot;: &quot;0&quot;,
        &quot;errmsg&quot;: &quot;ok&quot;,
        &quot;msgid&quot;: &quot;325381129559375872&quot;
```
 仅供参考，代码也就这样哈！</string>
              </value>
            </member>
            <member>
                <name>categories</name>
                <value>
                  <array>
                    <data>
                        <value>
                            <string>[Markdown]</string>
                        </value>
                     </data>
                   </array>
                  </value>
            </member>
        </struct>
       </value>
    </param>
    <param>
       <value>
        <boolean>1</boolean>
       </value>
    </param>
</params></methodCall>

2018-06-15 14:08:05：response is empty

2018-06-15 14:10:07：array (
  0 => 
  array (
    'queueId' => 16,
    'blogId' => 12,
    'action' => 1,
    'publishStatus' => 0,
    'response' => '',
    'createtime' => '2018-06-15',
    'updatetime' => '2018-06-15',
    'blogType' => 6,
  ),
)

2018-06-15 14:10:07：<?xml version="1.0" encoding="utf-8"?>
<methodCall>
<methodName>metaWeblog.newPost</methodName>
<params>
    <param>
        <value>
        <string>1</string>
        </value>
    </param>
    <param>
        <value>
        <string>jueze</string>
        </value>
    </param>
    <param>
        <value>
        <string>yi877900230!</string>
        </value>
    </param>
    <param>
       <value>
        <struct>
            <member>
              <name>title</name>
              <value>
                <string>微信公众号-模板消息通用接口封装</string>
              </value>
            </member>
            <member>
              <name>description</name>
              <value>
                <string>### 微信公众号-模板消息通用接口封装
近期做了微信公众号的消息通知，微信方面模板越来越规范化，跟测试的平台相差甚远（fuck，谁让人家要办硬）。

话不多说，进入代码
```php
class OfficialSystem
{
    public $tmplateConf;
    private $accessToken;       //微信accessToken

    public function __construct( $tmplateConf ,$accessToken ){
        $this-&gt;tmplateConf = $tmplateConf;
        $this-&gt;accessToken = $accessToken;
    }

    /**
    * 返回结果
    * @param $error bool 1 代表错误，0 无错误
    * @parame $msg string   返回信息
    * @param $data Array    返回内容
    * @param $isJson bool  1 返回json， 0 否
    **/
    public function returnResult( $error,$msg ,$data=[],$isJson=0 ){
        $result = [
            &apos;error&apos; =&gt; $error,
            &apos;msg&apos; =&gt; $msg,
            &apos;data&apos; =&gt; $data,
        ];
        if( $isJson ){
            echo json_encode($result);
            exit();
        }
        return $result;
    }

    /**
    * 发送消息
    * @param $modelId sting  微信模板id
    * @param $touser string  微信openid（公众号）
    * @param $url string    跳转地址
    * @param $miniPagepath string 小程序跳转路径
    * @param $miniAppid  string   小程序Appid
    * @param $list  Array   模板数据，如：[ [&apos;value&apos;=&gt;&apos;您好，您有新的订单&apos;,&apos;color&apos;=&gt;&apos;blue&apos;,...] ]
    **/
    public function Sendmsg( $modelId,$touser,$url,$miniPagepath,$miniAppid,$list=[] ){
        if( empty($modelId) || empty($touser) || empty($list)  ) $this-&gt;returnResult(1,&apos;参数缺失&apos;);

        $template_id =  !empty( $this-&gt;tmplateConf[$modelId] ) ? $this-&gt;tmplateConf[$modelId]:$this-&gt;returnResult(1,&apos;模板错误&apos;);

        //模板消息内容  数组第一个作为标题，最后一个作为备注
        $data = [];
        foreach ($list as $k=&gt;$v){
            $key = $k==0 ? &apos;first&apos;:&quot;keyword&quot;.$k;

            if( !isset( $list[$k+1] ) ) $key = &apos;remark&apos;;

            $data[$key] = [
                &apos;value&apos; =&gt;  $v[&apos;value&apos;],
                &apos;color&apos; =&gt;  !empty($v[&apos;color&apos;])? $v[&apos;color&apos;]:&apos;#173177&apos;,
            ];
        }

        $sends = $this-&gt;sendModelMsg($touser,$template_id,$url,$miniAppid,$miniPagepath,$data);

        $this-&gt;returnResult(0,&apos;success&apos;,$sends);
    }

    /**
     * @param $touser   用户openid
     * @param $template_id
     * @param $url
     * @param $miniAppid
     * @param $miniPagepath     小程序跳转地址
     * @param $data     模板数据
     */
    public function sendModelMsg( $touser,$template_id,$url=&apos;&apos;,$miniAppid=&apos;&apos;,$miniPagepath=&apos;&apos;,$data ){

        $interfaceUrl = &apos;https://api.weixin.qq.com/cgi-bin/message/template/send?access_token=&apos;.$this-&gt;accessToken;

        $params = [
            &apos;touser&apos;            =&gt;          $touser,
            &apos;template_id&apos;       =&gt;          $template_id,
            &apos;url&apos;               =&gt;          $url,
            &apos;miniprogram&apos;       =&gt;          [ &apos;appid&apos;=&gt;$miniAppid,&apos;path&apos;=&gt;$miniPagepath ]   ,
            &apos;data&apos;              =&gt;          $data,
        ];

        $sends = $this-&gt;httpPost($interfaceUrl,json_encode($params));
        $sends = json_decode($sends,1);

        if( $sends&amp;&amp;$sends[&apos;errmsg&apos;]!=&apos;ok&apos; ){
             $this-&gt;returnResult(1,&apos;消息发送失败&apos;,$sends);
        }

        return $sends;
    }

    /**
     * 获取用户信息
     * @param $openid  openid
     * @return mixed
     */
    public function getUserInfo( $openid=&apos;&apos; ){

        $interfaceUrl = &apos;https://api.weixin.qq.com/cgi-bin/user/info?access_token=&apos;.$this-&gt;accessToken.&apos;&amp;openid=&apos;.$openid;
        $info = $this-&gt;httpGet( $interfaceUrl );
        $result = json_decode($info,1);

        return $result;
    }

    /**
     * @param $touser
     * @param $msgtype
     * @param $msgContent
     */
    public function sendCustomMsg( $touser,$msgtype,$msgContent){
//        $params = [];
//        $params[&apos;touser&apos;] = $touser;
//        $params[&apos;msgtype&apos;] = $msgtype;
//        $params[&quot;$msgtype&quot;] = $msgContent;
//        $params = json_encode($params);
        $params = &apos;{&quot;touser&quot;:&quot;&apos;.$touser.&apos;&quot;,&quot;msgtype&quot;:&quot;&apos;.$msgtype.&apos;&quot;,&quot;text&quot;:{&apos;.$msgContent.&apos;}}&apos;;

        $interfaceUrl = &apos;https://api.weixin.qq.com/cgi-bin/message/custom/send?access_token=&apos;.$this-&gt;accessToken;
        $sends = $this-&gt;httpPost($interfaceUrl,$params);//var_dump($params,json_encode($params),$sends);die;
        $sends = json_decode($sends,1);
        return $sends;
    }

    private function httpGet($url) {
        $curl = curl_init();

        curl_setopt_array($curl, array(
            CURLOPT_URL =&gt; $url,
            CURLOPT_RETURNTRANSFER =&gt; true,
            CURLOPT_ENCODING =&gt; &quot;&quot;,
            CURLOPT_MAXREDIRS =&gt; 10,
            CURLOPT_TIMEOUT =&gt; 30,
            CURLOPT_HTTP_VERSION =&gt; CURL_HTTP_VERSION_1_1,
            CURLOPT_CUSTOMREQUEST =&gt; &quot;GET&quot;,
            CURLOPT_HTTPHEADER =&gt; array(
                &quot;cache-control: no-cache&quot;,
                &quot;content-type: application/x-www-form-urlencoded&quot;,
            ),
        ));

        $response = curl_exec($curl);
        $err = curl_error($curl);

        curl_close($curl);

        if ($err) {
            echo &quot;cURL Error #:&quot; . $err;die;
        } else {
            return $response;
        }
    }

    private function httpPost($url,$param){
        $curl = curl_init();

        curl_setopt_array($curl, array(
            CURLOPT_URL =&gt; $url,
            CURLOPT_RETURNTRANSFER =&gt; true,
            CURLOPT_ENCODING =&gt; &quot;&quot;,
            CURLOPT_MAXREDIRS =&gt; 10,
            CURLOPT_TIMEOUT =&gt; 30,
            CURLOPT_HTTP_VERSION =&gt; CURL_HTTP_VERSION_1_1,
            CURLOPT_CUSTOMREQUEST =&gt; &quot;POST&quot;,
            CURLOPT_POSTFIELDS =&gt; $param,
            CURLOPT_HTTPHEADER =&gt; array(
                &quot;cache-control: no-cache&quot;,
                &quot;content-type: application/json&quot;,
                &apos;Content-Length:&apos; . strlen($param)
            ),
        ));

        $response = curl_exec($curl);
        $err = curl_error($curl);

        curl_close($curl);

        if ($err) {
            return &quot;cURL Error #:&quot; . $err;
        } else {
            return $response;
        }

}
```


调用事例：
```php
$tmplateConf = [
     &apos;1&apos;      =&gt;  &apos;mnscOp2RHpQtDCt7OpZBLoDTU2fjJ_W75_Mat4rnfxM&apos;,         //订货通知模板
     &apos;2&apos;      =&gt;  &apos;DL4EAD47KT1tggbL2OR8iRAYLORI64V4YEM8mjQfSWU&apos;,         //入库通知模板
];
$accessToken = &apos;o9BuWjkDBvLGV_nch9wPU_-KRp7M&apos;;
$OfficialSystem = new OfficialSystem($tmplateConf,$accessToken);

//消息内容
$list = [
        [&apos;value&apos;=&gt;&apos;您好，您有新的订单&apos;,&apos;color&apos;=&gt;&apos;blue&apos;],
        [&apos;value&apos;=&gt;&apos;P201809010001&apos;,&apos;color&apos;=&gt;&apos;&apos;],
        [&apos;value&apos;=&gt;&apos;服务中心店&apos;,&apos;color&apos;=&gt;&apos;&apos;],
        [&apos;value&apos;=&gt;&apos;2018-06-01 10:30:30&apos;,&apos;color&apos;=&gt;&apos;&apos;],
        [&apos;value&apos;=&gt;&apos;点击进入详情&apos;,&apos;color&apos;=&gt;&apos;&apos;],
    ];
$modelId = 1;
$touser = &apos;o9BuWjkDBvLGV_nch9wPU_-KRp7M&apos;;
$url = &apos;http://www.cnblogs.com/followyou&apos;;
$sends = Sendmsg( $modelId,$touser,$url,$miniPagepath=&apos;&apos;,$miniAppid=&apos;&apos;,$list);
var_dump($sends);
```

成功返回：
```
        &quot;errcode&quot;: &quot;0&quot;,
        &quot;errmsg&quot;: &quot;ok&quot;,
        &quot;msgid&quot;: &quot;325381129559375872&quot;
```
 仅供参考，代码也就这样哈！</string>
              </value>
            </member>
            <member>
                <name>categories</name>
                <value>
                  <array>
                    <data>
                        <value>
                            <string>[Markdown]</string>
                        </value>
                     </data>
                   </array>
                  </value>
            </member>
        </struct>
       </value>
    </param>
    <param>
       <value>
        <boolean>1</boolean>
       </value>
    </param>
</params></methodCall>

